# iOS开发之Runtime常用示例总结
经常有小伙伴私下在Q上问一些关于Runtime的东西，问我有没有Runtime的相关博客，之前还真没正儿八经的总结过。之前只是在解析第三方框架源码时，聊过一些用法，也就是这些第三方框架中用到的Runtime。比如属性关联，动态获取属性等等。本篇博客就针对Runtime这个主题来总结一些其常用的一些方法，当然“空谈误国”，今天博客中所聊的Runtime依然要依托于本篇博客所涉及的Demo。

本篇博客所聊的Runtime的内容大概有：动态获取类名、动态获取类的成员变量、动态获取类的属性列表、动态获取类的方法列表、动态获取类所遵循的协议列表、动态添加新的方法、类的实例方法实现的交换、动态属性关联、消息发送与消息转发机制等。当然，本篇博客总结的是运行时常用的功能，并不是所有Runtime的内容。

###一、构建Runtime测试用例
本篇博客的内容是依托于实例的，所以我们在本篇博客中先构建我们的测试类，Runtime将会对该类进行相关的操作。下方就是本篇博客所涉及Demo的目录，上面的RuntimeKit类是讲Runtime常用的功能进行了简单的封装，而下方的TestClass以及相关的类目就是我们Runtime要操作的对象了。下方会对TestClass以及类目中的内容进行详细介绍。
![](http://images2015.cnblogs.com/blog/545446/201701/545446-20170118101510578-1257087631.png)

下方这几个截图就是我们的测试类TestClass的主要部分，因为TestClass是专门用来测试的类，所以其涉及的内容要尽量的全面。TestClass遵循了NSCoding, NSCopying这两个协议，并且为其添加了公有属性、私有属性、私有成员变量、 公有实例方法、私有实例方法、类方法等。这些添加的内容，都将是我们Runtime的操作对象。下方那几个TestClass的类目稍后在使用Runtime时再进行介绍。
![](http://images2015.cnblogs.com/blog/545446/201701/545446-20170118103313015-1479742483.png)
![](http://images2015.cnblogs.com/blog/545446/201701/545446-20170118103417765-232417568.png)
![](http://images2015.cnblogs.com/blog/545446/201701/545446-20170118103544421-84919050.png)


###二、RuntimeKit的封装

接下来我们就来看看RuntimeKit中的内容，其中对Runtime常用的方法进行了简单的封装。主要是动态的获取类的一些属性和方法的，以及动态方法添加和方法交换的。本部分的干货还是不少的。

####1、获取类名
动态的获取类名是比较简单的，使用class_getName(Class)就可以在运行时来获取类的名称。class_getName()函数返回的是一个char类型的指针，也就是C语言的字符串类型，所以我们要将其转换成NSString类型，然后再返回出去。下方的+fetchClassName:方法就是我们封装的获取类名的方法，如下所示：
![](http://images2015.cnblogs.com/blog/545446/201701/545446-20170118112743265-118863449.png)

####2、获取成员变量
下方这个+fetchIvarList:这个方法就是我们封装的获取类的成员变量的方法。当然我们在获取成员变量时，可以用ivar_getTypeEncoding()来获取相应成员变量的类型。使用ivar_getName()来获取相应成员变量的名称。下方就是对获取成员变量的功能的封装。返回的是一个数组，数组的元素是一个字典，而字典中存储的就是相应成员变量的名称和类型。
![](http://images2015.cnblogs.com/blog/545446/201701/545446-20170118113158109-999455528.png)

下方就是调用上述方法获取的TestClass类的成员变量。当然在运行时就没有什么私有和公有之分了，只要是成员变量就可以获取到。在OC中的给类添加成员属性其实就是添加了一个成员变量和getter以及setter方法。所以获取的成员列表中肯定带有成员属性，不过成员属性的名称前方添加了下划线来与成员属性进行区分。我们也可以获取成员变量的类型，下方的_var1是NSInteger类型，动态获取到的是q字母，其实是NSInteger的符号。而i就表示int类型，c表示Bool类型，d表示double类型，f则就表示float类型。当然这些基本类型都是由一个字母代替的，如果是引用类型的话，则直接就是一个字符串了，比如NSArray类型就是"@NSArray"。
![](http://images2015.cnblogs.com/blog/545446/201701/545446-20170118113754109-548155613.png)

####3.获取成员属性

上面获取的是类的成员变量，那么下方这个+fetchPropertyList:获取的就是成员属性。当然此刻获取的只包括成员属性，也就是那些有setter或者getter方法的成员变量。下方主要是使用了class_copyPropertyList(Class,&count)来获取的属性列表，然后通过for循环通过property_getName()来获取每个属性的名字。当然使用property_getName()获取到的名字依然是C语言的char类型的指针，所以我们还需要将其转换成NSString类型，然后放到数组中一并返回。如下所示：
